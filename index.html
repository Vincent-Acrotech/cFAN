<!DOCTYPE html>
<html>

	<head> 
		<meta charset="utf-8">
		<title>Discovery for cFAN</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
		
	<body style="text-align:center">		
		<h1>
			<img src="./image/PhNetwork.png" alt="chip" width="64" height="64" "
			style="./image/vertical-align:top"> Discovery
		</h1>			
					
		<center>			
			<button id="linkBtn" onclick="linkWeb()" ><img id="image" width=32 height=32 src="./image/JamLink.png"></button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<button id="unLinkBtn" onclick="unlinkLine(linkIndex)"><img id="image" width=32 height=32 src="./image/BxUnlink.png"></button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<button id="msgBtn" onclick="unlinkLine(linkIndex)"><img id="image" width=32 height=32 src="./image/BxUnlink.png"></button>			
		</center>
		
		<center>
			<canvas id="myCanvas" width="450" height="710" 
				style="border:1px solid #d3d3d3;background:#ffffff">
				<img src="./image/voip-gateway-128.png" alt="gateway" width=128 height=128 id="imgGateway">
				<img src="./image/IconParkOutlineCpu.png" alt="chip" width=128 height=128 id="imgDrt">
				<img src="./image/mobile-phone-8-128.png" alt="phone" width=128px height=128px id="imgPhone">			
			</canvas>				
		</center>
		
		<script>
			var c=document.getElementById("myCanvas"),
				ctx=c.getContext("2d"),	
				img=document.getElementById("imgGateway"),
				img1=document.getElementById("imgPhone"),	
				img2=document.getElementById("imgDrt"),						
				canvas = document.querySelector("canvas"),					
			
				// image position index
				gtwp  = {x: 212, y:  52},
				iphp  = {x: 28,  y:  52},
				drt1p = {x: 230, y: 221},
				drt2p = {x: 230, y: 376},
				drt3p = {x: 128, y: 507},
				drt4p = {x: 332, y: 507},
				drt5p = {x:  46, y: 221},
				
				// image placed location and size
				gtw =  {inx: img,  x:  gtwp.x, y:  gtwp.y, w: 84, h: 84},				
				iph =  {inx: img1, x:  iphp.x, y:  iphp.y, w: 84, h: 84},
				drt1 = {inx: img2, x: drt1p.x, y: drt1p.y, w: 48, h: 48},
				drt2 = {inx: img2, x: drt2p.x, y: drt2p.y, w: 48, h: 48},
				drt3 = {inx: img2, x: drt3p.x, y: drt3p.y, w: 48, h: 48},
				drt4 = {inx: img2, x: drt4p.x, y: drt4p.y, w: 48, h: 48},
				drt5 = {inx: img2, x: drt5p.x, y: drt5p.y, w: 48, h: 48},
				
				// initial image tooltip text
				gtwtext = "gateway",
				iphtext = "APP",
				
				drt1text = "Device Name:DRT1 <br>" + 
							"Device UUID:<br>" + "&nbsp f15e5f6e-909f-<br>" +
							"&nbsp 4a07-9e78-<br>" + "&nbsp d66e7a2b55d6<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-12RDP-33837992",
				
				drt2text = "Device Name:DRT2 <br>" + 
							"Device UUID:<br>" + "&nbsp ec7d9aa9-e5ee-<br>" +
							"&nbsp 4ca9-9dc6-<br>" + "&nbsp 7310fadf3937<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-12RDP-33837992",	
							
				drt3text = "Device Name:DRT3 <br>" + 
							"Device UUID:<br>" + "&nbsp 5782dfc5-b976-<br>" +
							"&nbsp 4f36-b56b-<br>" + "&nbsp 402c8e2a7fdf<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-12RDP-33837992",
							
				drt4text = "Device Name:DRT4 <br>" + 
							"Device UUID:<br>" + "&nbsp bb57bed2-37b9-<br>" +
							"&nbsp 4de0-96fc-<br>" + "&nbsp 23e1932097a4<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-12RDP-33837992",
							
				drt5text = "Device Name:DRT5 <br>" + 
							"Device UUID:<br>" + "&nbsp 44497e1b-cb02-<br>" +
							"&nbsp 4a0d-aefa-<br>" + "&nbsp cad6ba1d1643<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-12RDP-33837992",	
	
			// create a tool-tip instance:
				tgtw = new ToolTip(canvas, gtw, gtwtext, 50, 5000),
				tiph = new ToolTip(canvas, iph, iphtext, 50, 5000),
				tdrt1 = new ToolTip(canvas, drt1, drt1text, 180, 5000),
				tdrt2 = new ToolTip(canvas, drt2, drt2text, 180, 5000),
				tdrt3 = new ToolTip(canvas, drt3, drt3text, 180, 5000),
				tdrt4 = new ToolTip(canvas, drt4, drt4text, 180, 5000),
				tiph5 = new ToolTip(canvas, drt5, drt5text, 180, 5000);
			
			// The Tool-Tip instance:
			function ToolTip(canvas, region, text, width, timeout) {

			  var me = this,                                // self-reference for event handlers
				  div = document.createElement("div"),      // the tool-tip div
				  parent = canvas.parentNode,               // parent node for canvas
				  visible = false;                          // current status
			  
			  // set some initial styles, can be replaced by class-name etc.
			  div.style.cssText = 
					"font-family:monospace;position:fixed;text-align:left;padding:7px;color:white;background:blue;pointer-events:none;width:" + width + "px";
			  div.innerHTML = text;
			  
			  // show the tool-tip
			  this.show = function(pos) {
				if (!visible) {                             // ignore if already shown (or reset time)
				  visible = true;                           // lock so it's only shown once
				  setDivPos(pos);                           // set position
				  parent.appendChild(div);                  // add to parent of canvas
				  setTimeout(hide, timeout);                // timeout for hide
				}
			  }
			  
			  // hide the tool-tip
			  function hide() {
				visible = false;                            // hide it after timeout
				parent.removeChild(div);                    // remove from DOM
			  }

			  // check mouse position, add limits as wanted... just for example:
			  function check(e) {				
				var pos = getPos(e),
					posAbs = {x: e.clientX, y: e.clientY};  // div is fixed, so use clientX/Y
				if (!visible &&
							pos.x >= region.x && pos.x < region.x + region.w &&
							pos.y >= region.y && pos.y < region.y + region.h) {	
					div.innerHTML = updateDrtData(region);
					//div.innerHTML = region.x + ":" + region.y;
					me.show(posAbs);          				// show tool-tip at this pos
				}
				else {
					setDivPos(posAbs);                     // otherwise, update position
					hide();
				}
			  }
			  
			  // get mouse position relative to canvas
			  function getPos(e) {
				var r = canvas.getBoundingClientRect();
				return {x: e.clientX - r.left, y: e.clientY - r.top}
			  }
			  
			  // update and adjust div position if needed (anchor to a different corner etc.)
			  function setDivPos(pos) {
				if (visible){
				  if (pos.x < 0) pos.x = 0;
				  if (pos.y < 0) pos.y = 0;
				  // other bound checks here
				  div.style.left = pos.x + "px";
				  div.style.top = pos.y + "px";
				}
			  }
			  
			  // we need to use shared event handlers:
			  <!--canvas.addEventListener("mousemove", check);
			  canvas.addEventListener("click", check);			 
			}	
			
			img.addEventListener("load", (e) => {			
			  ctx.drawImage(gtw.inx, gtw.x, gtw.y, gtw.w, gtw.h);	
			  ctx.drawImage(iph.inx, iph.x, iph.y, iph.w, iph.h);	
			  ctx.drawImage(drt5.inx, drt5.x, drt5.y, drt5.w, drt5.h);	
			  ctx.drawImage(drt1.inx, drt1.x, drt1.y, drt1.w, drt1.h);	
			  ctx.drawImage(drt2.inx, drt2.x, drt2.y, drt2.w, drt2.h);	
			  ctx.drawImage(drt3.inx, drt3.x, drt3.y, drt3.w, drt3.h);	
			  ctx.drawImage(drt4.inx, drt4.x, drt4.y, drt4.w, drt4.h);
			  
			});					
			
			function updateDrtData(pos) {
				if(pos.x==gtwp.x && pos.y==gtwp.y) return gtwtext;				
				else if(pos.x==iphp.x && pos.y==iphp.y) return iphtext;
				else if(pos.x==drt1p.x && pos.y==drt1p.y) return drt1text;
				else if(pos.x==drt2p.x && pos.y==drt2p.y) return drt2text;
				else if(pos.x==drt3p.x && pos.y==drt3p.y) return drt3text;
				else if(pos.x==drt4p.x && pos.y==drt4p.y) return drt4text;
				else if(pos.x==drt5p.x && pos.y==drt1p.y) return drt5text;
				else return "not available";
			}
			
			function clearLine(hx,hy,ex,ey) {		
				<!-- setLineDash([x,y]) x=segment px, y=gap px -->		
				ctx.strokeStyle = '#ffffff';
				ctx.lineWidth="5";
				ctx.setLineDash([3,3]);	
				ctx.beginPath();   
				ctx.moveTo(hx,hy);  
				ctx.lineTo(ex,ey);   		
				ctx.stroke();			
			}
			
			function drawLine(hx,hy,ex,ey) {						
				clearLine(hx,hy,ex,ey);				
				ctx.strokeStyle = '#0000ff';
				ctx.lineWidth="1";
				ctx.setLineDash([3,3]);	
				ctx.beginPath();   
				ctx.moveTo(hx,hy);  
				ctx.lineTo(ex,ey);   		
				ctx.stroke();	
			}
			
			function textStyle() {
				ctx.font = "20pt NSimSun";
				ctx.fillStyle = '#0000ff';
				ctx.fillText("APP", 50, 50);	
			}
			
			function putText(text,x,y,txtFont) {
				ctx.font = txtFont;
				ctx.fillStyle = '#000000';
				ctx.fillText(text, x, y);
			}

			function linkLine(lineInx) {
				switch (lineInx) {
					case 0:
						drawLine(70,138,70,221);
						break;
					case 1:
						drawLine(94,245,230,245);
						break;
					case 2:
						drawLine(254,136,254,221);
						break;
					case 3:
						drawLine(254,269,254,376);
						break;
					case 4:
						drawLine(254,426,150,507);
						break;
					case 5:
						drawLine(254,426,355,507);
						break;
				}
			
			}
			
			function unlinkLine(lineInx) {
				switch (lineInx) {
					case 0:
						clearLine(70,138,70,221);
						break;
					case 1:
						clearLine(94,245,230,245);
						break;
					case 2:
						clearLine(254,136,254,221);
						break;
					case 3:
						clearLine(254,269,254,376);
						break;
					case 4:
						clearLine(254,426,150,507);
						break;
					case 5:
						clearLine(254,426,355,507);
						break;
				}
			
			}			
			
			function linkWeb() {
				gtwtext = "1234";
				
			}
			
			linkLine(0);
			linkLine(1);
			linkLine(2);
			linkLine(3);
			linkLine(4);
			linkLine(5);
			
			putText("APP",57,95,"13pt NSimSun")
			putText("Field Gateway",195,45,"13pt NSimSun")
			putText("DRT 5",85,220,"11pt NSimSun")
			putText("DRT 1",268,220,"11pt NSimSun")
			putText("Root",268,203,"11pt NSimSun")
			putText("DRT 2",268,375,"11pt NSimSun")
			putText("Local Base",268,358,"11pt NSimSun")
			putText("DRT 3",131,573,"11pt NSimSun")
			putText("DRT 4",335,573,"11pt NSimSun")
		</script>
				
	</body>

</html>
