<!DOCTYPE html>
<html>

	<head> 
		<meta charset="utf-8">
		<title>Discovery for cFAN</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">					
	</head>
		
	<body style="text-align:center">		
		<h1>
			<img src="./image/PhNetwork.png" alt="chip" width="64" height="64" "
			style="./image/vertical-align:top"> Discovery
		</h1>			
					
		<center>			
			<button id="linkBtn" onclick="linkLine(0)"><img id="image" width=32 height=32 src="./image/JamLink.png"></button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<button id="unLinkBtn" onclick="unlinkLine(0)"><img id="image" width=32 height=32 src="./image/BxUnlink.png"></button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;			
		</center>
		
		<center>
			<canvas id="myCanvas" width="450" height="650" 
				style="border:1px solid #d3d3d3;background:#ffffff">
				<img src="./image/voip-gateway-128.png" alt="gateway" width=128 height=128 id="imgGateway">
				<img src="./image/IconParkOutlineCpu.png" alt="chip" width=128 height=128 id="imgDrt">				
			</canvas>				
		</center>
		
		<script>			
			
			var c=document.getElementById("myCanvas"),
				ctx=c.getContext("2d"),	
				img=document.getElementById("imgGateway"),	
				img2=document.getElementById("imgDrt"),						
				canvas = document.querySelector("canvas"),					
							
				// image position index
				gtwp  = {x: 182, y:  52, w: 84, h: 84},				
				drt1p = {x: 200, y: 221, w: 48, h: 48},
				drt2p = {x: 200, y: 376, w: 48, h: 48},
				drt3p = {x: 98,  y: 507, w: 48, h: 48},
				drt4p = {x: 302, y: 507, w: 48, h: 48},
				drt5p = {x: 200, y: 507, w: 48, h: 48},
				
				// image placed location and size
				gtw =  {inx: img,  x:  gtwp.x, y:  gtwp.y, w: gtwp.w,  h: gtwp.h},								
				drt1 = {inx: img2, x: drt1p.x, y: drt1p.y, w: drt1p.w, h: drt1p.h},
				drt2 = {inx: img2, x: drt2p.x, y: drt2p.y, w: drt2p.w, h: drt2p.h},
				drt3 = {inx: img2, x: drt3p.x, y: drt3p.y, w: drt3p.w, h: drt3p.h},
				drt4 = {inx: img2, x: drt4p.x, y: drt4p.y, w: drt4p.w, h: drt4p.h},
				drt5 = {inx: img2, x: drt5p.x, y: drt5p.y, w: drt5p.w, h: drt5p.h},
				
				// connection line of start and end
				gtwBottomP  = {x: gtwp.x+(gtwp.w/2),   y: (gtw.y+gtw.h)},
				drt1TopP    = {x: drt1p.x+(drt1p.w/2), y:  drt1p.y},
				drt1BottomP = {x: drt1p.x+(drt1p.w/2), y: (drt1p.y+drt1p.h)},
				drt2TopP    = {x: drt2p.x+(drt2p.w/2), y: (drt2p.y)},
				drt2BottomP = {x: drt2p.x+(drt2p.w/2), y: (drt2p.y+drt2p.h)},
				drt3TopP    = {x: drt3p.x+(drt3p.w/2), y:  drt3p.y},
				drt4TopP    = {x: drt4p.x+(drt4p.w/2), y:  drt4p.y},
				drt5TopP    = {x: drt5p.x+(drt5p.w/2), y:  drt5p.y},
				
				// image text
				imgTextFont = "12pt NSimSun",
				gtwText     = "Field Gateway",
				drt1Text1   = "Root",
				drt1Text2   = "DRT 1",
				drt2Text1   = "Local Base",
				drt2Text2   = "DRT 2",
				drt3Text    = "DRT 3",
				drt4Text    = "DRT 4",
				drt5Text    = "DRT 5",
				
				// image text position
				gtwTextP   = {text: gtwText,    x: gtwp.x-15,  y: gtwp.y-7},
				drt1Text1P = {text: drt1Text1,  x: drt1p.x+38, y: drt1p.y-18},
				drt1Text2P = {text: drt1Text2,  x: drt1p.x+38, y: drt1p.y-1},
				drt2Text1P = {text: drt2Text1,  x: drt2p.x+38, y: drt2p.y-18},
				drt2Text2P = {text: drt2Text2,  x: drt2p.x+38, y: drt2p.y-1},
				drt3TextP  = {text: drt3Text,   x: drt3p.x+3,  y: drt3p.y+66},
				drt4TextP  = {text: drt4Text,   x: drt4p.x+3,  y: drt4p.y+66},
				drt5TextP  = {text: drt5Text,   x: drt5p.x+3,  y: drt3p.y+66},
				
				
				// initial image tooltip text
				gtwtext  = "Field Gateway",
				
				drt1text = "Device Name:DRT1 <br>" + 
							"Device UUID:<br>" + "&nbsp f15e5f6e-909f-<br>" +
							"&nbsp 4a07-9e78-<br>" + "&nbsp d66e7a2b55d6<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-12RDP-33837992",
				
				drt2text = "Device Name:DRT2 <br>" + 
							"Device UUID:<br>" + "&nbsp ec7d9aa9-e5ee-<br>" +
							"&nbsp 4ca9-9dc6-<br>" + "&nbsp 7310fadf3937<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-12RDP-83743235",	
							
				drt3text = "Device Name:DRT3 <br>" + 
							"Device UUID:<br>" + "&nbsp 5782dfc5-b976-<br>" +
							"&nbsp 4f36-b56b-<br>" + "&nbsp 402c8e2a7fdf<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-32MRP-32783454",
							
				drt4text = "Device Name:DRT4 <br>" + 
							"Device UUID:<br>" + "&nbsp bb57bed2-37b9-<br>" +
							"&nbsp 4de0-96fc-<br>" + "&nbsp 23e1932097a4<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-11SDM-87237575",
							
				drt5text = "Device Name:DRT5 <br>" + 
							"Device UUID:<br>" + "&nbsp 44497e1b-cb02-<br>" +
							"&nbsp 4a0d-aefa-<br>" + "&nbsp cad6ba1d1643<br>" + 
							"Device Location:<br>" + "&nbsp HLTPE-05FNC-42252766",	
	
			// create a tool-tip instance:
				tgtw = new ToolTip(canvas, gtw, gtwtext, 95, 5000),				
				tdrt1 = new ToolTip(canvas, drt1, drt1text, 160, 5000),
				tdrt2 = new ToolTip(canvas, drt2, drt2text, 160, 5000),
				tdrt3 = new ToolTip(canvas, drt3, drt3text, 160, 5000),
				tdrt4 = new ToolTip(canvas, drt4, drt4text, 160, 5000),
				tiph5 = new ToolTip(canvas, drt5, drt5text, 160, 5000);
			
			// The Tool-Tip instance:
			function ToolTip(canvas, region, text, width, timeout) {

			  var me = this,                                // self-reference for event handlers
				  div = document.createElement("div"),      // the tool-tip div
				  parent = canvas.parentNode,               // parent node for canvas
				  visible = false;                          // current status
			  
			  // set some initial styles, can be replaced by class-name etc.
			  div.style.cssText = 
					"font-family:monospace;position:fixed;text-align:left;padding:7px;color:white;background:blue;pointer-events:none;width:" + width + "px";
			  div.innerHTML = text;
			  
			  // show the tool-tip
			  this.show = function(pos) {
				if (!visible) {                             // ignore if already shown (or reset time)
				  visible = true;                           // lock so it's only shown once
				  setDivPos(pos);                           // set position
				  parent.appendChild(div);                  // add to parent of canvas
				  setTimeout(hide, timeout);                // timeout for hide
				}
			  }
			  
			  // hide the tool-tip
			  function hide() {
				visible = false;                            // hide it after timeout
				parent.removeChild(div);                    // remove from DOM
			  }

			  // check mouse position, add limits as wanted... just for example:
			  function check(e) {				
				var pos = getPos(e),
					posAbs = {x: e.clientX, y: e.clientY};  // div is fixed, so use clientX/Y
				if (!visible &&
							pos.x >= region.x && pos.x < region.x + region.w &&
							pos.y >= region.y && pos.y < region.y + region.h) {	
					div.innerHTML = updateDrtData(region);
					//div.innerHTML = region.x + ":" + region.y;
					me.show(posAbs);          				// show tool-tip at this pos
				}
				else {
					setDivPos(posAbs);                     // otherwise, update position
					hide();
				}
			  }
			  
			  // get mouse position relative to canvas
			  function getPos(e) {
				var r = canvas.getBoundingClientRect();
				return {x: e.clientX - r.left, y: e.clientY - r.top}
			  }
			  
			  // update and adjust div position if needed (anchor to a different corner etc.)
			  function setDivPos(pos) {
				if (visible){
				  if (pos.x < 0) pos.x = 0;
				  if (pos.y < 0) pos.y = 0;
				  // other bound checks here
				  div.style.left = pos.x + "px";
				  div.style.top = pos.y + "px";
				}
			  }
			  
			  // we need to use shared event handlers:
			  <!--canvas.addEventListener("mousemove", check);
			  canvas.addEventListener("click", check);			 
			}	
			
			img.addEventListener("load", (e) => {			
			  ctx.drawImage(gtw.inx, gtw.x, gtw.y, gtw.w, gtw.h);				 
			  ctx.drawImage(drt1.inx, drt1.x, drt1.y, drt1.w, drt1.h);	
			  ctx.drawImage(drt2.inx, drt2.x, drt2.y, drt2.w, drt2.h);	
			  ctx.drawImage(drt3.inx, drt3.x, drt3.y, drt3.w, drt3.h);	
			  ctx.drawImage(drt4.inx, drt4.x, drt4.y, drt4.w, drt4.h);
			  ctx.drawImage(drt5.inx, drt5.x, drt5.y, drt5.w, drt5.h);	
			});					
			
			function updateDrtData(pos) {
				if(pos.x==gtwp.x && pos.y==gtwp.y) return gtwtext;				
				else if(pos.x==drt1p.x && pos.y==drt1p.y) return drt1text;
				else if(pos.x==drt2p.x && pos.y==drt2p.y) return drt2text;
				else if(pos.x==drt3p.x && pos.y==drt3p.y) return drt3text;
				else if(pos.x==drt4p.x && pos.y==drt4p.y) return drt4text;
				else if(pos.x==drt5p.x && pos.y==drt5p.y) return drt5text;
				else return "not available";
			}
			
			function clearLine(start,end) {		
				<!-- setLineDash([x,y]) x=segment px, y=gap px -->		
				ctx.strokeStyle = '#ffffff';
				ctx.lineWidth="8";
				ctx.setLineDash([3,3]);	
				ctx.beginPath();   
				ctx.moveTo(start.x,start.y);  
				ctx.lineTo(end.x,end.y);   		
				ctx.stroke();			
			}
			
			function drawLine(start,end) {						
				clearLine(start,end);				
				ctx.strokeStyle = '#0000ff';
				ctx.lineWidth="1";
				ctx.setLineDash([3,3]);	
				ctx.beginPath();   
				ctx.moveTo(start.x,start.y);  
				ctx.lineTo(end.x,end.y);   		
				ctx.stroke();	
			}						
			
			function putText(imgTextP,txtFont) {
				ctx.font = txtFont;
				ctx.fillStyle = '#000000';
				ctx.fillText(imgTextP.text, imgTextP.x, imgTextP.y);
			}

			function linkLine(lineInx) {
				switch (lineInx) {					
					case 0:
						drawLine(gtwBottomP,drt1TopP);
						break;
					case 1:
						drawLine(drt1BottomP,drt2TopP);
						break;
					case 2:
						drawLine(drt2BottomP,drt3TopP);
						break;
					case 3:
						drawLine(drt2BottomP,drt4TopP);
						break;
					case 4:
						drawLine(drt2BottomP,drt5TopP);
						break;
				}
			
			}
			
			function unlinkLine(lineInx) {
				switch (lineInx) {					
					case 0:
						clearLine(gtwBottomP,drt1TopP);
						break;
					case 1:
						clearLine(drt1BottomP,drt2TopP);
						break;
					case 2:
						clearLine(drt2BottomP,drt3TopP);
						break;
					case 3:
						clearLine(drt2BottomP,drt4TopP);
						break;
					case 4:
						clearLine(drt2BottomP,drt5TopP);
						break;				
				}
			
			}									
			
			putText(gtwTextP,imgTextFont);
			putText(drt1Text1P,imgTextFont);
			putText(drt1Text2P,imgTextFont);
			putText(drt2Text1P,imgTextFont);
			putText(drt2Text2P,imgTextFont);
			putText(drt3TextP,imgTextFont);
			putText(drt4TextP,imgTextFont);
			putText(drt5TextP,imgTextFont);
			
			for(let i = 0; i < 5; i++) {
				linkLine(i);
			}
			
		</script>
				
	</body>

</html>
